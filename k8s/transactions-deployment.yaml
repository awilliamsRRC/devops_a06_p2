apiVersion: apps/v1                 # using apps/v1 API since Deployment is part of the apps group
kind: Deployment                    # defines a Deployment resource (stateless application)
metadata:
  name: transactions                # Deployment must be named 'transactions'
  labels:
    app: transactions               # label 'app=transactions' so services can select these pods
spec:
  replicas: 2                       # run 2 replicas for high availability and load distribution
  revisionHistoryLimit: 2           # keep 2 old ReplicaSets for rollback
  selector:
    matchLabels:
      app: transactions             # this Deployment manages pods with label 'app=transactions'
  template:
    metadata:
      labels:
        app: transactions           # pod template labeled 'app=transactions'
    spec:
      containers:
        - name: transactions        # container name 'transactions'
          image: transactions:latest # requirement says use 'transactions:latest' image
          imagePullPolicy: Never    #force Kubernetes to use local image
          ports:
            - name: http            # naming the port 'http'
              containerPort: 3000   # exposing port 3000 inside the container
          env:                      # environment variables for the container
            - name: MONGO_URI
              value: mongodb://mongo:27017 # connect to MongoDB service named 'mongo'
            - name: PORT
              value: "3000"         # explicitly set PORT environment variable
          readinessProbe:           # probe to check if pod is ready to serve traffic
            tcpSocket:
              port: 3000            # TCP probe on port 3000
            initialDelaySeconds: 8  # wait 8s before first readiness check
            periodSeconds: 5        # check every 5s
          livenessProbe:            # probe to check if pod is healthy
            tcpSocket:
              port: 3000            # TCP probe on port 3000
            initialDelaySeconds: 25 # wait 25s before first liveness check
            periodSeconds: 10       # check every 10s
          resources:                # resource requests and limits
            requests:
              cpu: "100m"           # requests 0.1 CPU
              memory: "128Mi"       # requests 128Mi memory
            limits:
              cpu: "500m"           # limits to 0.5 CPU
              memory: "512Mi"       # limits to 512Mi memory
